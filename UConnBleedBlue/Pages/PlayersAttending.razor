@page "/playersAttending"

@using UConnBleedBlue.Models

@inject PlayersService PlayerService
@inject NavigationManager NavigationManager;

<style>
    h1 {
        display: table;
        margin: 10px auto;
        padding: 5px;
        font-size: 32px;
        color: #ffffff;
        text-align: center;
        text-shadow: 0 0 5px blue, 0 0 5px blue, 0 0 5px blue, 0 0 5px blue;
    }

    @@media (min-width: 768px) {
        h1 {
         font-size: 50px;
        }
    }

    .responsive-table {
        width: 100%;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
    }

    table {
        min-width: 600px;
    }

    .colorBlue th,
    .colorBlue td {
        white-space: nowrap;
        padding: 0.5rem;
    }

    /* optional: better keyboard focus */
    .registration-btn:focus-visible {
        outline: 2px solid #FFD700;
        outline-offset: 2px;
    }

    /* desktop size */
    @@media (min-width: 768px) {
        .registration-btn {
            font-size: 28px;
        }
    }

    .registration-btn:hover {
        background-color: #091A33; /* even darker on hover */
    }

    /* Make the counter a little bigger on larger screens */
    @@media (min-width: 768px) {
        .attending-count {
            font-size: 1.5rem;
        }
    }

    .registration-btn {
        display: inline-block;
        margin: 0;
        padding: 10px 20px;
        font-size: 20px;
        font-weight: 700;
        color: #FFD700; /* yellow text */
        background-color: #004aad; /* UConn blue */
        border: none;
        border-radius: 6px;
        cursor: pointer;
        text-align: center;
        text-shadow: 0 0 4px rgba(0,0,0,.4); /* subtle glow for legibility */
        transition: background-color 0.3s ease;
    }

    /* Big button on larger screens */
    @@media (min-width: 768px) {
        .registration-btn {
            font-size: 28px;
        }
    }

    /* Stack above the table */
    .top-stack {
        display: flex;
        flex-direction: column;
        align-items: center;   /* 👈 centers Row 2 & Row 3 horizontally */
        row-gap: .75rem;
        margin-bottom: 12px;
    }

    @@media (min-width: 768px) {
        .top-stack { row-gap: 1rem; }
    }

    /* Row 2 text */
    .attending-count {
        font-size: 1.25rem;
        font-weight: 700;
        color: blue;
        text-align: center;    /* 👈 center the text itself */
    }
    @@media (min-width: 768px) {
        .attending-count { font-size: 1.5rem; }
    }
</style>

<h1>UConn Football Players & Friends : @PlayerService.PlayerList.Count</h1>
<br />

<div class="top-stack">
    <div class="attending-count">
        <strong>Total Players Attending:</strong>
        @PlayerService.PlayerList.Count(p => p.AttendingTailgate)
    </div>

    <button class="registration-btn" @onclick='() => NavigationManager.NavigateTo("/mailing-list-form")'>
        Click - If you're not on our Football Alumni mailing list shown below
    </button>
</div>

@if (PlayerService?.PlayerList == null)
{
    <p><em>Loading...</em></p>
}
else
{
    <div class="responsive-table">
        <table class="table table-striped colorBlue">
            <thead>
                <tr>
                    <th></th>
                    <th>Name</th>
                    <th>Final Year</th>
                    <th>Attending<br>Tailgate</th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                @foreach (var player in @PlayerService.PlayerList)
                {
                    <tr>
                        <td>@player.Id</td>
                        <td>@player.Name</td>
                        <td>@player.FinalYear</td>
                        <td>@(player.AttendingTailgate ? "Yes" : "")</td>
                        <td></td>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th>*</th>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}

@code {
    public void ViewTeam(string? year, string? headCoach)
    {
        if ((year == null) || (headCoach == null))
        {
            return;
        }
        if ((year == "?") || (headCoach == "?"))
        {
            return;
        }
        if ((year == " ") || (headCoach == " "))
        {
            return;
        }
        // Save the required year and coach of the photo in the PlayerService which can be accessed by other components
        PlayerService.SelectedPlayerFinalYear = year;
        PlayerService.HeadCoach = headCoach;

        // Get the player's team photo of his final year
        PlayerService.ImageSource = $"wwwroot/imagesTeamPhotos/{PlayerService.SelectedPlayerFinalYear}.png";
        if (File.Exists(PlayerService.ImageSource) == false)
        {
            // If that's one of the missing team photos - try the previous year
            int previousYear = int.Parse(PlayerService.SelectedPlayerFinalYear) - 1;
            PlayerService.ImageSource = $"wwwroot/imagesTeamPhotos/{previousYear}.png";

            // if that picture does not exist - get error message pgoto
            if (File.Exists(PlayerService.ImageSource) == false)
            {
                PlayerService.ImageSource = "wwwroot/imagesTeamPhotos/MissingTeamPhoto.png";
            }
        }
        // remove prefix
        PlayerService.ImageSource = PlayerService.ImageSource.Substring(8);
    }
}
